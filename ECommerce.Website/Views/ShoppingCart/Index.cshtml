@using ECommerce.Logic.Objects
@{
    ViewBag.Title = "Index";
}

<h2>Koszyk</h2>
@foreach (var item in ShoppingCart.Items)
{
    <div style="display:flex; flex-direction: row;">
        <div style="width: 30px; height: 30px">
            <img src="~/Content/Pictures/@item.PhotoName" class="in-box-picture" />
        </div>
        <div style="margin-left:10px; min-width: 120px">
            @item.Name
        </div>
        @Html.Partial("CartAddRemovePartial", item.ID)
        <div style="min-width: 120px">
            (@item.Price za szt.) Suma: @item.TotalPrice zł
        </div>
    </div>
}

<div id="sum-price">
    <h2>Łącznie @ShoppingCart.Price zł</h2>
</div>

<div>
    <input type="hidden" id="udf5" name="udf5" value="300746" />
    <input type="hidden" id="surl" name="surl" value="f33cbcba1c5293b25771787bba818067" />
    <input type="hidden" id="key" name="key" value="386508" />
    <input type="hidden" id="salt" name="salt" value="9ef5b08611bf09c76982174baad970d3" />
    <input type="hidden" id="txnid" name="txnid" value="123" />
    <input type="hidden" id="amount" name="amount" value="@ShoppingCart.Price" />
    <input type="hidden" id="hash" name="hash" value="HASH" />

    <input type="text" id="fname" value="first name" />
    <input type="text" id="pinfo" value="prod info" />

    <div><input type="submit" value="Pay" onclick="console.log('kilk'); launchBOLT(); return false;" /></div>

</div>

@section Scripts {

    <script type="text/javascript">
        $(document).ready(function () {
            $('.add-button').click(function () {
                reload_div('#sum-price')
            })
            $('.remove-button').click(function () {
                reload_div('#sum-price')
            })

            @foreach(var item in ShoppingCart.Items)
            {
                <text>
                    add_and_remove_button_clicks('@Url.Action("AddToCart","ShoppingCart")', '@Url.Action("RemoveFromCart", "ShoppingCart")', @item.ID);
                </text>
            }
        })
    </script>
    @*
        <script src="http://code.jquery.com/jquery-latest.min.js" type="text/javascript"></script>
        <!-- this meta viewport is required for BOLT //-->
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
        <!-- BOLT Sandbox/test //-->
        <script id="bolt" src="https://sboxcheckout-static.citruspay.com/bolt/run/bolt.min.js" bolt-color="e34524" bolt-logo="http://boltiswatching.com/wp-content/uploads/2015/09/Bolt-Logo-e14421724859591.png"></script>

        <script type="text/javascript">
            function launchBOLT() {
                bolt.launch({
                    key: $('#key').val(),
                    txnid: $('#txnid').val(),
                    hash: $('#hash').val(),
                    amount: $('#amount').val(),
                    firstname: $('#fname').val(),
                    email: $('#email').val(),
                    phone: $('#mobile').val(),
                    productinfo: $('#pinfo').val(),
                    udf5: $('#udf5').val(),
                    surl: $('#surl').val(),
                    furl: $('#surl').val()
                }, {
                    responseHandler: function (BOLT) {
                        console.log(BOLT.response.txnStatus);
                        if (BOLT.response.txnStatus != 'CANCEL') {
                            //Salt is passd here for demo purpose only. For practical use keep salt at server side only.
                            var fr = '<form action=\"' + $('#surl').val() + '\" method=\"post\">' +
                                '<input type=\"hidden\" name=\"key\" value=\"' + BOLT.response.key + '\" />' +
                                '<input type=\"hidden\" name=\"salt\" value=\"' + $('#salt').val() + '\" />' +
                                '<input type=\"hidden\" name=\"txnid\" value=\"' + BOLT.response.txnid + '\" />' +
                                '<input type=\"hidden\" name=\"amount\" value=\"' + BOLT.response.amount + '\" />' +
                                '<input type=\"hidden\" name=\"productinfo\" value=\"' + BOLT.response.productinfo + '\" />' +
                                '<input type=\"hidden\" name=\"firstname\" value=\"' + BOLT.response.firstname + '\" />' +
                                '<input type=\"hidden\" name=\"email\" value=\"' + BOLT.response.email + '\" />' +
                                '<input type=\"hidden\" name=\"udf5\" value=\"' + BOLT.response.udf5 + '\" />' +
                                '<input type=\"hidden\" name=\"mihpayid\" value=\"' + BOLT.response.mihpayid + '\" />' +
                                '<input type=\"hidden\" name=\"status\" value=\"' + BOLT.response.status + '\" />' +
                                '<input type=\"hidden\" name=\"hash\" value=\"' + BOLT.response.hash + '\" />' +
                                '</form>';
                            var form = jQuery(fr);
                            jQuery('body').append(form);
                            form.submit();
                        }
                    },
                    catchException: function (BOLT) {
                        alert(BOLT.message);
                    }
                });
            }
        </script>
    *@
}